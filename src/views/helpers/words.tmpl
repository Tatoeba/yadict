<%c++ extern "C" { %> 
<%c++    #include "tato/fetcher.h" %>
<%c++    #include "tato/hyperitem.h" %>
<%c++    #include "tato/kvlist.h" %>
<%c++ } %>
<%c++ #include "contents/helpers/words.h" %>
<%c++ #include "contents/helpers/paginations.h" %>
<% skin %>
<% view words_helper uses contents::WordsHelper %>



    <% template word_group() %>
        <div>
            <% include word_alone() %>
        </div>
        <div>
            <% include word_metas() %>
        </div>
        <div>
            <% include word_all_translations() %>
        </div>
    <% end template %>

    <% template word_alone() %>
        <% c++ TatoHyperItem *item = content.fetcher->items[0] ;%>
        <% c++ out() << item->str ;%> 
    <% end template %>

    <% template word_metas() %>
        <% c++ TatoHyperItem *item = content.fetcher->items[0] ;%>

	    <% c++ TatoKvListNode *it; %>
        <ul>
	    <% c++ TATO_KVLIST_FOREACH(item->metas, it) { %>
            <li>
                <% c++ out() << it->key << " " ;%>
                :
                <% c++ out() << " " << it->value; %>
                
                <% c++ out() << " " ; %>
                <a href="<% url "/metas/edit/" %><% c++ out() << item->id; %>/<% c++ out() << it->key;%>" >
                    edit
                </a>
                <% c++ out() << " " ; %>
                <a href="<% url "/metas/remove-from/" %><% c++ out() << item->id; %>/<% c++ out() << it->key;%>" >
                    <img href="http://sysko.fr/img/icons/remove.png" alt="remove" />
                </a>
            </li>
        <% c++ } %>
        <% c++ if (item->metas == NULL) { %>
            <li>No Metas yet</li>
        <% c++ } %>
        </ul>
    <% end template %>

    <% template word_all_translations() %>
        <% c++ TatoHyperItem *item = content.fetcher->items[0] ;%>
        <h4>Translations</h4>
        <% foreach language in packedTrans %>
            <% item %>
                <div>
                    <h5><% language.first %></h5>
                    <% foreach translation in language.second %>
                        <ul>
                        <% item %>
                            <li>
                                <a href="<% url "/words/show/{1}" using translation->str %>" >
                                    <% translation->str %>
                                </a>
                                <% c++ out() << " " ; %>
                                <a href="<% url "/translations/remove/{1}/from/" using translation->id %><% c++ out() << item->id ;%>">
                                    <img href="http://sysko.fr/img/icons/remove.png" alt="remove" />
                                </a>
                            </li>
                        <% end %>
                        </ul>
                    <% end %>  
                </div>
            <% end %>
        <% empty %>
            No translations yet
        <% end%>

    <% end template %>

    <% template words_list(std::string title) %>
        <% c++ contents::PaginationsHelper phc( %>
        <% c++ content.fetcher->offset, %>
        <% c++ content.fetcher->capacity, %>
        <% c++ content.fetcher->max_size, %>
        <% c++ content.baseUrl, %>
        <% c++ content.lang %>
        <% c++ ); %>

        <h3>
            <% c++ out() << title ;%>
             (Total: <% c++ out() <<content.fetcher->max_size ;%> Word(s))
        </h3>
        
        <% c++ pagination_helper ph(out(), phc); %> 
        <% c++ ph.pagination(); %>

        <% c++ for(int i = 0; i < content.fetcher->size ; i++) { %>
            <% c++ int id = content.fetcher->items[i]->id ; %>
            <% c++ std::string str = std::string(content.fetcher->items[i]->str) ; %>
            <div>
                <img src="http://sysko.fr/img/<% c++ out() << content.fetcher->items[i]->lang->code ;%>.png" /> 
                <span><% c++ out() << str ;%></span>
                <!--
                    TODO once we will have a singleton class to store lang etc, need to
                    put again url tag
                -->
                <a href="<% url "/words/show/" %><% c++ out() << str; %>">show</a>
                <a href="<% url "/words/edit/" %><% c++ out() << id; %>">edit</a>
                <a href="<% url "/words/delete-by-id/" %><% c++ out() << id; %>">
                    <img href="http://sysko.fr/img/icons/remove.png" alt="delete" />
                </a>
            </div>
        <% c++ } %>
    <% end template %>

    <% template translate_word_link() %>
        <% if not is_empty() %>
            <% c++ int id = content.fetcher->items[0]->id ;%>
            <a href="<% url "/translations/add-to/" %><% c++ out() << id ;%>" >
                translate
            </a> 
        <% end %>
    <% end template %>

    <% template add_meta_link() %>
        <% if not is_empty() %>
            <% c++ int id = content.fetcher->items[0]->id ;%>
            <a href="<% url "/metas/add/" %><% c++ out() << id ;%>" >
                add meta
            </a> 
        <% end %>
    <% end template %>

<% end view %>
<% end skin %>
